<style> code { white-space: pre-wrap; display: block; background-color: #eee; }.executed { background-color: #afa; }.reverted { background-color: #ffa; }.unexecuted { background-color: #faa; }.neutral { background-color: #eee; }</style><b>/home/tarun/work/contri/fuzz-vs-fv/fund-eq-of-dai-certora/Testvat.sol</b>
<code>
  1 |     | <span class='neutral'>// SPDX-License-Identifier: AGPL-3.0-or-later</span>
  2 |     | <span class='neutral'></span>
  3 |     | <span class='neutral'>pragma solidity ^0.8.13;</span>
  4 |     | <span class='neutral'></span>
  5 |     | <span class='neutral'>import &quot;Vat.sol&quot;;</span>
  6 | *r  | <span class='executed'></span>
  7 |     | <span class='neutral'>contract TestVat is Vat {</span>
  8 |     | <span class='unexecuted'>    bytes32[] public ilkIds;</span>
  9 |     | <span class='neutral'></span>
 10 |     | <span class='unexecuted'>    constructor() {</span>
 11 |     | <span class='unexecuted'>        Line = 1e66;</span>
 12 |     | <span class='neutral'>    }</span>
 13 |     | <span class='neutral'></span>
 14 | *r  | <span class='executed'>    function init(bytes32 ilk) public override auth {</span>
 15 | *r  | <span class='executed'>        super.init(ilk);</span>
 16 | *   | <span class='executed'>        ilks[ilk].spot = 1e66;</span>
 17 | *   | <span class='executed'>        ilks[ilk].line = 1e66;</span>
 18 | *   | <span class='executed'>        ilkIds.push(ilk);</span>
 19 |     | <span class='neutral'>    }</span>
 20 |     | <span class='neutral'></span>
 21 | r   | <span class='reverted'>    function frob(bytes32 i, address u, int256 dink, int256 dart) public {</span>
 22 | r   | <span class='reverted'>        frob(i, u, u, u,dink,dart);</span>
 23 |     | <span class='neutral'>    }</span>
 24 |     | <span class='neutral'></span>
 25 |     | <span class='unexecuted'>    function sumOfDebt() public view returns (uint256) {</span>
 26 |     | <span class='unexecuted'>        uint256 length = ilkIds.length;</span>
 27 |     | <span class='unexecuted'>        uint256 sum = 0;</span>
 28 |     | <span class='unexecuted'>        for (uint256 i=0; i &lt; length; ++i){</span>
 29 |     | <span class='unexecuted'>            sum = sum + ilks[ilkIds[i]].Art * ilks[ilkIds[i]].rate;</span>
 30 |     | <span class='neutral'>        }</span>
 31 |     | <span class='unexecuted'>        return sum;</span>
 32 |     | <span class='neutral'>    }</span>
 33 |     | <span class='neutral'></span>
 34 |     | <span class='unexecuted'>    function echidna_nonzeroart() public view returns (bool) {</span>
 35 |     | <span class='unexecuted'>        uint256 length = ilkIds.length;</span>
 36 |     | <span class='unexecuted'>        bool isZero = true;</span>
 37 |     | <span class='unexecuted'>        for (uint256 i=0; i &lt; length; ++i){</span>
 38 |     | <span class='unexecuted'>            isZero = ilks[ilkIds[i]].Art == 0;</span>
 39 |     | <span class='unexecuted'>            if (!isZero) {</span>
 40 |     | <span class='unexecuted'>                return isZero;</span>
 41 |     | <span class='neutral'>            }</span>
 42 |     | <span class='neutral'>        }</span>
 43 |     | <span class='unexecuted'>        return isZero;</span>
 44 |     | <span class='neutral'>    }</span>
 45 |     | <span class='neutral'></span>
 46 |     | <span class='unexecuted'>    function echidna_fund_eq() public view returns (bool) {</span>
 47 |     | <span class='unexecuted'>        return debt == vice + sumOfDebt();</span>
 48 |     | <span class='neutral'>    }</span>
 49 |     | <span class='neutral'>}</span>

</code>
<br />

<b>/home/tarun/work/contri/fuzz-vs-fv/fund-eq-of-dai-certora/Vat.sol</b>
<code>
   1 |     | <span class='neutral'>// SPDX-License-Identifier: AGPL-3.0-or-later</span>
   2 |     | <span class='neutral'></span>
   3 |     | <span class='neutral'>/// vat.sol -- Dai CDP database</span>
   4 |     | <span class='neutral'></span>
   5 |     | <span class='neutral'>// Note: this is a somewhat updated version from that on Ethereum mainnet,</span>
   6 |     | <span class='neutral'>// representing an intermediate product during preparation for deployment of</span>
   7 |     | <span class='neutral'>// MCD on other domains. See https://github.com/makerdao/xdomain-dss. It is not</span>
   8 |     | <span class='neutral'>// recommended to use or deploy this version. This repo is for pedagogical</span>
   9 |     | <span class='neutral'>// purposes only.</span>
  10 |     | <span class='neutral'></span>
  11 |     | <span class='neutral'>// Copyright (C) 2018 Rain &lt;rainbreak@riseup.net&gt;</span>
  12 |     | <span class='neutral'>//</span>
  13 |     | <span class='neutral'>// This program is free software: you can redistribute it and/or modify</span>
  14 |     | <span class='neutral'>// it under the terms of the GNU Affero General Public License as published by</span>
  15 |     | <span class='neutral'>// the Free Software Foundation, either version 3 of the License, or</span>
  16 |     | <span class='neutral'>// (at your option) any later version.</span>
  17 |     | <span class='neutral'>//</span>
  18 |     | <span class='neutral'>// This program is distributed in the hope that it will be useful,</span>
  19 |     | <span class='neutral'>// but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
  20 |     | <span class='neutral'>// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
  21 |     | <span class='neutral'>// GNU Affero General Public License for more details.</span>
  22 |     | <span class='neutral'>//</span>
  23 |     | <span class='neutral'>// You should have received a copy of the GNU Affero General Public License</span>
  24 |     | <span class='neutral'>// along with this program.  If not, see &lt;https://www.gnu.org/licenses/&gt;.</span>
  25 |     | <span class='neutral'></span>
  26 |     | <span class='neutral'>pragma solidity ^0.8.13;</span>
  27 |     | <span class='unexecuted'></span>
  28 |     | <span class='neutral'>contract Vat {</span>
  29 |     | <span class='neutral'>    // --- Data ---</span>
  30 |     | <span class='unexecuted'>    mapping (address =&gt; uint256) public wards;</span>
  31 |     | <span class='neutral'></span>
  32 |     | <span class='unexecuted'>    mapping(address =&gt; mapping (address =&gt; uint256)) public can;</span>
  33 |     | <span class='neutral'></span>
  34 |     | <span class='neutral'>    struct Ilk {</span>
  35 |     | <span class='neutral'>        uint256 Art;   // Total Normalised Debt     [wad]</span>
  36 |     | <span class='neutral'>        uint256 rate;  // Accumulated Rates         [ray]</span>
  37 |     | <span class='neutral'>        uint256 spot;  // Price with Safety Margin  [ray]</span>
  38 |     | <span class='neutral'>        uint256 line;  // Debt Ceiling              [rad]</span>
  39 |     | <span class='neutral'>        uint256 dust;  // Urn Debt Floor            [rad]</span>
  40 |     | <span class='neutral'>    }</span>
  41 |     | <span class='neutral'>    struct Urn {</span>
  42 |     | <span class='neutral'>        uint256 ink;   // Locked Collateral  [wad]</span>
  43 |     | <span class='neutral'>        uint256 art;   // Normalised Debt    [wad]</span>
  44 |     | <span class='neutral'>    }</span>
  45 |     | <span class='neutral'></span>
  46 | *   | <span class='executed'>    mapping (bytes32 =&gt; Ilk)                       public ilks;</span>
  47 |     | <span class='unexecuted'>    mapping (bytes32 =&gt; mapping (address =&gt; Urn )) public urns;</span>
  48 |     | <span class='unexecuted'>    mapping (bytes32 =&gt; mapping (address =&gt; uint)) public gem;  // [wad]</span>
  49 |     | <span class='unexecuted'>    mapping (address =&gt; uint256)                   public dai;  // [rad]</span>
  50 | *   | <span class='executed'>    mapping (address =&gt; uint256)                   public sin;  // [rad]</span>
  51 |     | <span class='neutral'></span>
  52 |     | <span class='unexecuted'>    uint256 public debt;  // Total Dai Issued    [rad]</span>
  53 |     | <span class='unexecuted'>    uint256 public vice;  // Total Unbacked Dai  [rad]</span>
  54 |     | <span class='unexecuted'>    uint256 public Line;  // Total Debt Ceiling  [rad]</span>
  55 |     | <span class='unexecuted'>    uint256 public live;  // Active Flag</span>
  56 |     | <span class='neutral'></span>
  57 |     | <span class='neutral'>    // --- Events ---</span>
  58 |     | <span class='neutral'>    event Rely(address indexed usr);</span>
  59 |     | <span class='neutral'>    event Deny(address indexed usr);</span>
  60 |     | <span class='neutral'>    event Init(bytes32 indexed ilk);</span>
  61 |     | <span class='neutral'>    event File(bytes32 indexed what, uint256 data);</span>
  62 |     | <span class='neutral'>    event File(bytes32 indexed ilk, bytes32 indexed what, uint256 data);</span>
  63 |     | <span class='neutral'>    event Cage();</span>
  64 |     | <span class='neutral'>    event Hope(address indexed from, address indexed to);</span>
  65 |     | <span class='neutral'>    event Nope(address indexed from, address indexed to);</span>
  66 |     | <span class='neutral'>    event Slip(bytes32 indexed ilk, address indexed usr, int256 wad);</span>
  67 |     | <span class='neutral'>    event Flux(bytes32 indexed ilk, address indexed src, address indexed dst, uint256 wad);</span>
  68 |     | <span class='neutral'>    event Move(address indexed src, address indexed dst, uint256 rad);</span>
  69 |     | <span class='neutral'>    event Frob(bytes32 indexed i, address indexed u, address v, address w, int256 dink, int256 dart);</span>
  70 |     | <span class='neutral'>    event Fork(bytes32 indexed ilk, address indexed src, address indexed dst, int256 dink, int256 dart);</span>
  71 |     | <span class='neutral'>    event Grab(bytes32 indexed i, address indexed u, address v, address w, int256 dink, int256 dart);</span>
  72 |     | <span class='neutral'>    event Heal(address indexed u, uint256 rad);</span>
  73 |     | <span class='neutral'>    event Suck(address indexed u, address indexed v, uint256 rad);</span>
  74 |     | <span class='neutral'>    event Fold(bytes32 indexed i, address indexed u, int256 rate);</span>
  75 |     | <span class='neutral'></span>
  76 |     | <span class='neutral'>    modifier auth {</span>
  77 | *r  | <span class='executed'>        require(wards[msg.sender] == 1, &quot;Vat/not-authorized&quot;);</span>
  78 |     | <span class='neutral'>        _;</span>
  79 |     | <span class='neutral'>    }</span>
  80 |     | <span class='neutral'></span>
  81 | *r  | <span class='executed'>    function wish(address bit, address usr) internal view returns (bool) {</span>
  82 | *r  | <span class='executed'>        return either(bit == usr, can[bit][usr] == 1);</span>
  83 |     | <span class='neutral'>    }</span>
  84 |     | <span class='neutral'></span>
  85 |     | <span class='neutral'>    // --- Init ---</span>
  86 |     | <span class='unexecuted'>    constructor() {</span>
  87 |     | <span class='unexecuted'>        wards[msg.sender] = 1;</span>
  88 |     | <span class='unexecuted'>        live = 1;</span>
  89 |     | <span class='unexecuted'>        emit Rely(msg.sender);</span>
  90 |     | <span class='neutral'>    }</span>
  91 |     | <span class='neutral'></span>
  92 |     | <span class='neutral'>    // --- Math ---</span>
  93 | *r  | <span class='executed'>    function _add(uint256 x, int256 y) internal pure returns (uint256 z) {</span>
  94 |     | <span class='neutral'>        unchecked {</span>
  95 | *r  | <span class='executed'>            z = x + uint256(y);</span>
  96 |     | <span class='neutral'>        }</span>
  97 | *r  | <span class='executed'>        require(y &gt;= 0 || z &lt;= x);</span>
  98 | *r  | <span class='executed'>        require(y &lt;= 0 || z &gt;= x);</span>
  99 |     | <span class='neutral'>    }</span>
 100 |     | <span class='neutral'></span>
 101 | *r  | <span class='executed'>    function _sub(uint256 x, int256 y) internal pure returns (uint256 z) {</span>
 102 |     | <span class='neutral'>        unchecked {</span>
 103 | *r  | <span class='executed'>            z = x - uint256(y);</span>
 104 |     | <span class='neutral'>        }</span>
 105 | *r  | <span class='executed'>        require(y &lt;= 0 || z &lt;= x);</span>
 106 | *r  | <span class='executed'>        require(y &gt;= 0 || z &gt;= x);</span>
 107 |     | <span class='neutral'>    }</span>
 108 |     | <span class='neutral'></span>
 109 | *r  | <span class='executed'>    function _int256(uint256 x) internal pure returns (int256 y) {</span>
 110 | *r  | <span class='executed'>        require((y = int256(x)) &gt;= 0);</span>
 111 |     | <span class='neutral'>    }</span>
 112 |     | <span class='neutral'></span>
 113 |     | <span class='neutral'>    // --- Administration ---</span>
 114 | *r  | <span class='executed'>    function rely(address usr) external auth {</span>
 115 | *   | <span class='executed'>        require(live == 1, &quot;Vat/not-live&quot;);</span>
 116 | *   | <span class='executed'>        wards[usr] = 1;</span>
 117 | *   | <span class='executed'>        emit Rely(usr);</span>
 118 |     | <span class='neutral'>    }</span>
 119 |     | <span class='neutral'></span>
 120 | *r  | <span class='executed'>    function deny(address usr) external auth {</span>
 121 | *   | <span class='executed'>        require(live == 1, &quot;Vat/not-live&quot;);</span>
 122 | *   | <span class='executed'>        wards[usr] = 0;</span>
 123 | *   | <span class='executed'>        emit Deny(usr);</span>
 124 |     | <span class='neutral'>    }</span>
 125 |     | <span class='neutral'></span>
 126 | *r  | <span class='executed'>    function init(bytes32 ilk) public virtual auth {</span>
 127 | *r  | <span class='executed'>        require(ilks[ilk].rate == 0, &quot;Vat/ilk-already-init&quot;);</span>
 128 | *   | <span class='executed'>        ilks[ilk].rate = 10 ** 27;</span>
 129 | *   | <span class='executed'>        emit Init(ilk);</span>
 130 |     | <span class='neutral'>    }</span>
 131 |     | <span class='neutral'></span>
 132 |     | <span class='unexecuted'>    function file(bytes32 what, uint256 data) public auth {</span>
 133 |     | <span class='unexecuted'>        require(live == 1, &quot;Vat/not-live&quot;);</span>
 134 |     | <span class='unexecuted'>        if (what == &quot;Line&quot;) Line = data;</span>
 135 |     | <span class='unexecuted'>        else revert(&quot;Vat/file-unrecognized-param&quot;);</span>
 136 |     | <span class='unexecuted'>        emit File(what, data);</span>
 137 |     | <span class='neutral'>    }</span>
 138 |     | <span class='neutral'></span>
 139 |     | <span class='unexecuted'>    function file(bytes32 ilk, bytes32 what, uint256 data) public auth {</span>
 140 |     | <span class='unexecuted'>        require(live == 1, &quot;Vat/not-live&quot;);</span>
 141 |     | <span class='unexecuted'>        if (what == &quot;spot&quot;) ilks[ilk].spot = data;</span>
 142 |     | <span class='unexecuted'>        else if (what == &quot;line&quot;) ilks[ilk].line = data;</span>
 143 |     | <span class='unexecuted'>        else if (what == &quot;dust&quot;) ilks[ilk].dust = data;</span>
 144 |     | <span class='unexecuted'>        else revert(&quot;Vat/file-unrecognized-param&quot;);</span>
 145 |     | <span class='unexecuted'>        emit File(ilk, what, data);</span>
 146 |     | <span class='neutral'>    }</span>
 147 |     | <span class='neutral'></span>
 148 |     | <span class='unexecuted'>    function cage() external auth {</span>
 149 |     | <span class='unexecuted'>        live = 0;</span>
 150 |     | <span class='unexecuted'>        emit Cage();</span>
 151 |     | <span class='neutral'>    }</span>
 152 |     | <span class='neutral'></span>
 153 |     | <span class='neutral'>    // --- Structs getters ---</span>
 154 |     | <span class='unexecuted'>    function Art(bytes32 ilk) external view returns (uint256 Art_) {</span>
 155 |     | <span class='unexecuted'>        Art_ = ilks[ilk].Art;</span>
 156 |     | <span class='neutral'>    }</span>
 157 |     | <span class='neutral'></span>
 158 |     | <span class='unexecuted'>    function rate(bytes32 ilk) external view returns (uint256 rate_) {</span>
 159 |     | <span class='unexecuted'>        rate_ = ilks[ilk].rate;</span>
 160 |     | <span class='neutral'>    }</span>
 161 |     | <span class='neutral'></span>
 162 |     | <span class='unexecuted'>    function spot(bytes32 ilk) external view returns (uint256 spot_) {</span>
 163 |     | <span class='unexecuted'>        spot_ = ilks[ilk].spot;</span>
 164 |     | <span class='neutral'>    }</span>
 165 |     | <span class='neutral'></span>
 166 | *   | <span class='executed'>    function line(bytes32 ilk) external view returns (uint256 line_) {</span>
 167 | *   | <span class='executed'>        line_ = ilks[ilk].line;</span>
 168 |     | <span class='neutral'>    }</span>
 169 |     | <span class='neutral'></span>
 170 |     | <span class='unexecuted'>    function dust(bytes32 ilk) external view returns (uint256 dust_) {</span>
 171 |     | <span class='unexecuted'>        dust_ = ilks[ilk].dust;</span>
 172 |     | <span class='neutral'>    }</span>
 173 |     | <span class='neutral'></span>
 174 |     | <span class='unexecuted'>    function ink(bytes32 ilk, address urn) external view returns (uint256 ink_) {</span>
 175 |     | <span class='unexecuted'>        ink_ = urns[ilk][urn].ink;</span>
 176 |     | <span class='neutral'>    }</span>
 177 |     | <span class='neutral'></span>
 178 | *   | <span class='executed'>    function art(bytes32 ilk, address urn) external view returns (uint256 art_) {</span>
 179 | *   | <span class='executed'>        art_ = urns[ilk][urn].art;</span>
 180 |     | <span class='neutral'>    }</span>
 181 |     | <span class='neutral'></span>
 182 |     | <span class='neutral'>    // --- Allowance ---</span>
 183 | *   | <span class='executed'>    function hope(address usr) external {</span>
 184 | *   | <span class='executed'>        can[msg.sender][usr] = 1;</span>
 185 | *   | <span class='executed'>        emit Hope(msg.sender, usr);</span>
 186 |     | <span class='neutral'>    }</span>
 187 |     | <span class='neutral'></span>
 188 | *   | <span class='executed'>    function nope(address usr) external {</span>
 189 | *   | <span class='executed'>        can[msg.sender][usr] = 0;</span>
 190 | *   | <span class='executed'>        emit Nope(msg.sender, usr);</span>
 191 |     | <span class='neutral'>    }</span>
 192 |     | <span class='neutral'></span>
 193 |     | <span class='neutral'>    // --- Fungibility ---</span>
 194 | *r  | <span class='executed'>    function slip(bytes32 ilk, address usr, int256 wad) external auth {</span>
 195 | *r  | <span class='executed'>        gem[ilk][usr] = _add(gem[ilk][usr], wad);</span>
 196 | *   | <span class='executed'>        emit Slip(ilk, usr, wad);</span>
 197 |     | <span class='neutral'>    }</span>
 198 |     | <span class='neutral'></span>
 199 | *r  | <span class='executed'>    function flux(bytes32 ilk, address src, address dst, uint256 wad) external {</span>
 200 | *r  | <span class='executed'>        require(wish(src, msg.sender), &quot;Vat/not-allowed&quot;);</span>
 201 | *r  | <span class='executed'>        gem[ilk][src] = gem[ilk][src] - wad;</span>
 202 | *   | <span class='executed'>        gem[ilk][dst] = gem[ilk][dst] + wad;</span>
 203 | *   | <span class='executed'>        emit Flux(ilk, src, dst, wad);</span>
 204 |     | <span class='neutral'>    }</span>
 205 |     | <span class='neutral'></span>
 206 | r   | <span class='reverted'>    function move(address src, address dst, uint256 rad) external {</span>
 207 | r   | <span class='reverted'>        require(wish(src, msg.sender), &quot;Vat/not-allowed&quot;);</span>
 208 | r   | <span class='reverted'>        dai[src] = dai[src] - rad;</span>
 209 |     | <span class='unexecuted'>        dai[dst] = dai[dst] + rad;</span>
 210 |     | <span class='unexecuted'>        emit Move(src, dst, rad);</span>
 211 |     | <span class='neutral'>    }</span>
 212 |     | <span class='neutral'></span>
 213 | *r  | <span class='executed'>    function either(bool x, bool y) internal pure returns (bool z) {</span>
 214 | *r  | <span class='executed'>        assembly{ z := or(x, y)}</span>
 215 |     | <span class='neutral'>    }</span>
 216 |     | <span class='neutral'></span>
 217 | r   | <span class='reverted'>    function both(bool x, bool y) internal pure returns (bool z) {</span>
 218 | r   | <span class='reverted'>        assembly{ z := and(x, y)}</span>
 219 |     | <span class='neutral'>    }</span>
 220 |     | <span class='neutral'></span>
 221 |     | <span class='neutral'>    // --- CDP Manipulation ---</span>
 222 | r   | <span class='reverted'>    function frob(bytes32 i, address u, address v, address w, int256 dink, int256 dart) public {</span>
 223 |     | <span class='neutral'>        // system is live</span>
 224 | r   | <span class='reverted'>        require(live == 1, &quot;Vat/not-live&quot;);</span>
 225 |     | <span class='neutral'></span>
 226 | r   | <span class='reverted'>        Urn memory urn = urns[i][u];</span>
 227 | r   | <span class='reverted'>        Ilk memory ilk = ilks[i];</span>
 228 |     | <span class='neutral'>        // ilk has been initialised</span>
 229 | r   | <span class='reverted'>        require(ilk.rate != 0, &quot;Vat/ilk-not-init&quot;);</span>
 230 |     | <span class='neutral'></span>
 231 | r   | <span class='reverted'>        urn.ink = _add(urn.ink, dink);</span>
 232 | r   | <span class='reverted'>        urn.art = _add(urn.art, dart);</span>
 233 | r   | <span class='reverted'>        ilk.Art = _add(ilk.Art, dart);</span>
 234 |     | <span class='neutral'></span>
 235 | r   | <span class='reverted'>        int256 dtab = _int256(ilk.rate) * dart;</span>
 236 | r   | <span class='reverted'>        uint256 tab = ilk.rate * urn.art;</span>
 237 | r   | <span class='reverted'>        debt     = _add(debt, dtab);</span>
 238 |     | <span class='neutral'></span>
 239 |     | <span class='neutral'>        // either debt has decreased, or debt ceilings are not exceeded</span>
 240 | r   | <span class='reverted'>        require(either(dart &lt;= 0, both(ilk.Art * ilk.rate &lt;= ilk.line, debt &lt;= Line)), &quot;Vat/ceiling-exceeded&quot;);</span>
 241 |     | <span class='neutral'>        // urn is either less risky than before, or it is safe</span>
 242 |     | <span class='unexecuted'>        require(either(both(dart &lt;= 0, dink &gt;= 0), tab &lt;= urn.ink * ilk.spot), &quot;Vat/not-safe&quot;);</span>
 243 |     | <span class='neutral'></span>
 244 |     | <span class='neutral'>        // urn is either more safe, or the owner consents</span>
 245 |     | <span class='unexecuted'>        require(either(both(dart &lt;= 0, dink &gt;= 0), wish(u, msg.sender)), &quot;Vat/not-allowed-u&quot;);</span>
 246 |     | <span class='neutral'>        // collateral src consents</span>
 247 |     | <span class='unexecuted'>        require(either(dink &lt;= 0, wish(v, msg.sender)), &quot;Vat/not-allowed-v&quot;);</span>
 248 |     | <span class='neutral'>        // debt dst consents</span>
 249 |     | <span class='unexecuted'>        require(either(dart &gt;= 0, wish(w, msg.sender)), &quot;Vat/not-allowed-w&quot;);</span>
 250 |     | <span class='neutral'></span>
 251 |     | <span class='neutral'>        // urn has no debt, or a non-dusty amount</span>
 252 |     | <span class='unexecuted'>        require(either(urn.art == 0, tab &gt;= ilk.dust), &quot;Vat/dust&quot;);</span>
 253 |     | <span class='neutral'></span>
 254 |     | <span class='unexecuted'>        gem[i][v] = _sub(gem[i][v], dink);</span>
 255 |     | <span class='unexecuted'>        dai[w]    = _add(dai[w],    dtab);</span>
 256 |     | <span class='neutral'></span>
 257 |     | <span class='unexecuted'>        urns[i][u] = urn;</span>
 258 |     | <span class='unexecuted'>        ilks[i]    = ilk;</span>
 259 |     | <span class='neutral'></span>
 260 |     | <span class='unexecuted'>        emit Frob(i, u, v, w, dink, dart);</span>
 261 |     | <span class='neutral'>    }</span>
 262 |     | <span class='neutral'></span>
 263 |     | <span class='neutral'>    // --- CDP Fungibility ---</span>
 264 | r   | <span class='reverted'>    function fork(bytes32 ilk, address src, address dst, int256 dink, int256 dart) external {</span>
 265 | r   | <span class='reverted'>        Urn storage u = urns[ilk][src];</span>
 266 | r   | <span class='reverted'>        Urn storage v = urns[ilk][dst];</span>
 267 | r   | <span class='reverted'>        Ilk storage i = ilks[ilk];</span>
 268 |     | <span class='neutral'></span>
 269 | r   | <span class='reverted'>        u.ink = _sub(u.ink, dink);</span>
 270 | r   | <span class='reverted'>        u.art = _sub(u.art, dart);</span>
 271 | r   | <span class='reverted'>        v.ink = _add(v.ink, dink);</span>
 272 | r   | <span class='reverted'>        v.art = _add(v.art, dart);</span>
 273 |     | <span class='neutral'></span>
 274 |     | <span class='unexecuted'>        uint256 utab = u.art * i.rate;</span>
 275 |     | <span class='unexecuted'>        uint256 vtab = v.art * i.rate;</span>
 276 |     | <span class='neutral'></span>
 277 |     | <span class='neutral'>        // both sides consent</span>
 278 |     | <span class='unexecuted'>        require(both(wish(src, msg.sender), wish(dst, msg.sender)), &quot;Vat/not-allowed&quot;);</span>
 279 |     | <span class='neutral'></span>
 280 |     | <span class='neutral'>        // both sides safe</span>
 281 |     | <span class='unexecuted'>        require(utab &lt;= u.ink * i.spot, &quot;Vat/not-safe-src&quot;);</span>
 282 |     | <span class='unexecuted'>        require(vtab &lt;= v.ink * i.spot, &quot;Vat/not-safe-dst&quot;);</span>
 283 |     | <span class='neutral'></span>
 284 |     | <span class='neutral'>        // both sides non-dusty</span>
 285 |     | <span class='unexecuted'>        require(either(utab &gt;= i.dust, u.art == 0), &quot;Vat/dust-src&quot;);</span>
 286 |     | <span class='unexecuted'>        require(either(vtab &gt;= i.dust, v.art == 0), &quot;Vat/dust-dst&quot;);</span>
 287 |     | <span class='neutral'></span>
 288 |     | <span class='unexecuted'>        emit Fork(ilk, src, dst, dink, dart);</span>
 289 |     | <span class='neutral'>    }</span>
 290 |     | <span class='neutral'></span>
 291 |     | <span class='neutral'>    // --- CDP Confiscation ---</span>
 292 | *r  | <span class='executed'>    function grab(bytes32 i, address u, address v, address w, int256 dink, int256 dart) external auth {</span>
 293 | *r  | <span class='executed'>        Urn storage urn = urns[i][u];</span>
 294 | *r  | <span class='executed'>        Ilk storage ilk = ilks[i];</span>
 295 |     | <span class='neutral'></span>
 296 | *r  | <span class='executed'>        urn.ink = _add(urn.ink, dink);</span>
 297 | *r  | <span class='executed'>        urn.art = _add(urn.art, dart);</span>
 298 | *r  | <span class='executed'>        ilk.Art = _add(ilk.Art, dart);</span>
 299 |     | <span class='neutral'></span>
 300 | *r  | <span class='executed'>        int256 dtab = _int256(ilk.rate) * dart;</span>
 301 |     | <span class='neutral'></span>
 302 | *r  | <span class='executed'>        gem[i][v] = _sub(gem[i][v], dink);</span>
 303 | *   | <span class='executed'>        sin[w]    = _sub(sin[w],    dtab);</span>
 304 | *   | <span class='executed'>        vice      = _sub(vice,      dtab);</span>
 305 |     | <span class='neutral'></span>
 306 | *   | <span class='executed'>        emit Grab(i, u, v, w, dink, dart);</span>
 307 |     | <span class='neutral'>    }</span>
 308 |     | <span class='neutral'></span>
 309 |     | <span class='neutral'>    // --- Settlement ---</span>
 310 | *r  | <span class='executed'>    function heal(uint256 rad) external {</span>
 311 | *r  | <span class='executed'>        address u = msg.sender;</span>
 312 | *r  | <span class='executed'>        sin[u] = sin[u] - rad;</span>
 313 | *r  | <span class='executed'>        dai[u] = dai[u] - rad;</span>
 314 | *   | <span class='executed'>        vice   = vice   - rad;</span>
 315 | *   | <span class='executed'>        debt   = debt   - rad;</span>
 316 |     | <span class='neutral'></span>
 317 | *   | <span class='executed'>        emit Heal(msg.sender, rad);</span>
 318 |     | <span class='neutral'>    }</span>
 319 |     | <span class='neutral'></span>
 320 | *r  | <span class='executed'>    function suck(address u, address v, uint256 rad) external auth {</span>
 321 | *r  | <span class='executed'>        sin[u] = sin[u] + rad;</span>
 322 | *r  | <span class='executed'>        dai[v] = dai[v] + rad;</span>
 323 | *r  | <span class='executed'>        vice   = vice   + rad;</span>
 324 | *   | <span class='executed'>        debt   = debt   + rad;</span>
 325 |     | <span class='neutral'></span>
 326 | *   | <span class='executed'>        emit Suck(u, v, rad);</span>
 327 |     | <span class='neutral'>    }</span>
 328 |     | <span class='neutral'></span>
 329 |     | <span class='neutral'>    // --- Rates ---</span>
 330 | *r  | <span class='executed'>    function fold(bytes32 i, address u, int256 rate_) external auth {</span>
 331 | *r  | <span class='executed'>        require(live == 1, &quot;Vat/not-live&quot;);</span>
 332 | *r  | <span class='executed'>        Ilk storage ilk = ilks[i];</span>
 333 | *r  | <span class='executed'>        ilk.rate    = _add(ilk.rate, rate_);</span>
 334 | *   | <span class='executed'>        int256 rad  = _int256(ilk.Art) * rate_;</span>
 335 | *   | <span class='executed'>        dai[u]      = _add(dai[u], rad);</span>
 336 | *   | <span class='executed'>        debt        = _add(debt,   rad);</span>
 337 |     | <span class='neutral'></span>
 338 | *   | <span class='executed'>        emit Fold(i, u, rate_);</span>
 339 |     | <span class='neutral'>    }</span>
 340 |     | <span class='neutral'>}</span>
 341 |     | <span class='neutral'></span>

</code>
<br />

